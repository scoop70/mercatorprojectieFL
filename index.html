<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <title>Flevoland in Mercator vs RD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

  <style>
    body { margin:0; padding:0; }
    #map { width: 100%; height: 100vh; }
    .switch-btn {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: white;
      border: 1px solid #ccc;
      padding: 6px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-family: sans-serif;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <button id="switch" class="switch-btn">ðŸ”„ Wissel naar RD</button>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- Proj4JS + Proj4Leaflet -->
  <script src="https://unpkg.com/proj4/dist/proj4.js"></script>
  <script src="https://unpkg.com/proj4leaflet"></script>

  <script>
    // RD-coÃ¶rdinatensysteem (Amersfoort)
    const rdCrs = new L.Proj.CRS('EPSG:28992',
      '+proj=sterea +lat_0=52.15616055555555 ' +
      '+lon_0=5.38763888888889 +k=0.9999079 ' +
      '+x_0=155000 +y_0=463000 +ellps=bessel ' +
      '+towgs84=565.417,50.3319,465.552,-0.398957,0.343988,-1.8774,4.0725 +units=m +no_defs',
      {
        transformation: L.Transformation(-1, -1, 0, 0),
        resolutions: [
          3440.64, 1720.32, 860.16, 430.08, 215.04, 107.52,
          53.76, 26.88, 13.44, 6.72, 3.36, 1.68, 0.84, 0.42
        ],
        origin: [0, 0]
      }
    );

    // Mercator kaart (standaard Leaflet)
    let map = L.map('map', {
      center: [52.5, 5.5],
      zoom: 9,
      crs: L.CRS.EPSG3857 // Mercator
    });

    // Mercator baselaag
    const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/">OSM</a>'
    }).addTo(map);

    // RD baselaag (PDOK BRT Achtergrondkaart via WMTS)
    const rdTiles = new L.tileLayer(
      "https://service.pdok.nl/brt/achtergrondkaart/wmts/v2_0/standaard/EPSG:28992/{z}/{x}/{y}.png",
      {
        attribution: "Kaart: PDOK BRT Achtergrondkaart",
        minZoom: 0,
        maxZoom: 13,
        continuousWorld: true
      }
    );

    // Flevoland polygoon (vereenvoudigd, WGS84 coords)
    const flevolandCoords = [
      [52.82, 5.35], [52.82, 5.82],
      [52.45, 5.82], [52.35, 5.55],
      [52.45, 5.20], [52.70, 5.20]
    ];

    let flevoland = L.polygon(flevolandCoords, {color: 'red', fillOpacity: 0.2}).addTo(map);

    // Wisselknop logica
    let inRD = false;
    document.getElementById('switch').addEventListener('click', function() {
      map.remove();
      document.getElementById('map').innerHTML = "";

      if (!inRD) {
        // RD kaart
        map = L.map('map', {
          crs: rdCrs,
          center: [52.5, 5.5],
          zoom: 2
        });
        rdTiles.addTo(map);

        // Polygoon opnieuw toevoegen (Leaflet transformeert zelf van WGS84 naar RD)
        flevoland = L.polygon(flevolandCoords, {color: 'red', fillOpacity: 0.2}).addTo(map);

        this.textContent = "ðŸ”„ Wissel naar Mercator";
        inRD = true;
      } else {
        // Terug naar Mercator
        map = L.map('map', {
          crs: L.CRS.EPSG3857,
          center: [52.5, 5.5],
          zoom: 9
        });
        osm.addTo(map);
        flevoland = L.polygon(flevolandCoords, {color: 'red', fillOpacity: 0.2}).addTo(map);

        this.textContent = "ðŸ”„ Wissel naar RD";
        inRD = false;
      }
    });
  </script>
</body>
</html>
